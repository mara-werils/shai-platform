import { CodeGroup } from '../code.tsx'
import { Row, Col, Properties, Property, Heading, SubProperty, Paragraph } from '../md.tsx'

# API чат-приложения

Чат-приложения поддерживают сохранение сессий, позволяя использовать предыдущую историю чата в качестве контекста для ответов. Это может применяться для чат-ботов, AI-службы поддержки клиентов и т.д.

<div>
  ### Базовый URL
  <CodeGroup title="Code" targetCode={props.appDetail.api_base_url}>
    ```javascript
    ```
  </CodeGroup>

  ### Аутентификация

  API сервиса использует аутентификацию через `API-Key`.
  <i>**Настоятельно рекомендуется хранить ваш API-ключ на стороне сервера, не передавать и не хранить его на стороне клиента, чтобы избежать возможной утечки API-ключа, которая может привести к серьезным последствиям.**</i>

  Для всех API-запросов включите ваш API-ключ в HTTP-заголовок `Authorization`, как показано ниже:

  <CodeGroup title="Code">
    ```javascript
      Authorization: Bearer {API_KEY}

    ```
  </CodeGroup>
</div>

---

<Heading
  url='/chat-messages'
  method='POST'
  title='Отправить сообщение в чат'
  name='#Send-Chat-Message'
/>
<Row>
  <Col>
    Отправить запрос в чат-приложение.

    ### Тело запроса

    <Properties>
      <Property name='query' type='string' key='query'>
        Содержимое ввода пользователя/вопроса
      </Property>
      <Property name='inputs' type='object' key='inputs'>
          Позволяет вводить различные значения переменных, определенных приложением.
          Параметр `inputs` содержит несколько пар ключ/значение, где каждый ключ соответствует конкретной переменной, а каждое значение является конкретным значением для этой переменной. По умолчанию `{}`
      </Property>
      <Property name='response_mode' type='string' key='response_mode'>
        Режим возврата ответа, поддерживает:
        - `streaming` Режим потоковой передачи (рекомендуется), реализует вывод в стиле печатной машинки через SSE ([Server-Sent Events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events)).
        - `blocking` Блокирующий режим, возвращает результат после завершения выполнения. (Запросы могут быть прерваны, если процесс длительный)
        Из-за ограничений Cloudflare запрос будет прерван без возврата через 100 секунд.
        <i>Примечание: блокирующий режим не поддерживается в режиме Agent Assistant</i>
      </Property>
      <Property name='user' type='string' key='user'>
          Идентификатор пользователя, используется для определения личности конечного пользователя для поиска и статистики.
          Должен быть уникально определен разработчиком в рамках приложения.
      </Property>
      <Property name='conversation_id' type='string' key='conversation_id'>
      ID беседы, для продолжения беседы на основе предыдущих записей чата необходимо передать conversation_id предыдущего сообщения.
      </Property>
      <Property name='files' type='array[object]' key='files'>
          Список файлов, подходит для ввода файлов (изображений) в сочетании с пониманием текста и ответами на вопросы, доступно только когда модель поддерживает возможность Vision.
          - `type` (string) Поддерживаемый тип: `image` (в настоящее время поддерживается только тип изображения)
          - `transfer_method` (string) Способ передачи, `remote_url` для URL изображения / `local_file` для загрузки файла
          - `url` (string) URL изображения (когда способ передачи - `remote_url`)
          - `upload_file_id` (string) ID загруженного файла, который должен быть получен путем загрузки через API загрузки файлов заранее (когда способ передачи - `local_file`)
      </Property>
      <Property name='auto_generate_name' type='bool' key='auto_generate_name'>
      Автоматически генерировать заголовок, по умолчанию `true`.
      Если установлено в `false`, можно достичь асинхронной генерации заголовка, вызвав API переименования беседы и установив `auto_generate` в `true`.
      </Property>
    </Properties>

    ### Ответ
    Когда response_mode равен blocking, возвращается объект CompletionResponse.
    Когда response_mode равен streaming, возвращается поток ChunkCompletionResponse.

    ### ChatCompletionResponse
    Возвращает полный результат приложения, `Content-Type` - `application/json`.
    - `event` (string) Тип события, фиксирован как `message`
    - `task_id` (string) ID задачи, используется для отслеживания запроса и интерфейса остановки ответа ниже
    - `id` (string) Уникальный ID
    - `message_id` (string) Уникальный ID сообщения
    - `conversation_id` (string) ID беседы
    - `mode` (string) Режим приложения, фиксирован как `chat`
    - `answer` (string) Полное содержимое ответа
    - `metadata` (object) Метаданные
      - `usage` (Usage) Информация об использовании модели
      - `retriever_resources` (array[RetrieverResource]) Список цитат и атрибуции
    - `created_at` (int) Временная метка создания сообщения, например, 1705395332

    ### ChunkChatCompletionResponse
    Возвращает фрагменты потока, выводимые приложением, `Content-Type` - `text/event-stream`.
    Каждый потоковый фрагмент начинается с `data:`, разделен двумя символами новой строки `\n\n`, как показано ниже:
    <CodeGroup>
    ```streaming {{ title: 'Response' }}
    data: {"event": "message", "task_id": "900bbd43-dc0b-4383-a372-aa6e6c414227", "id": "663c5084-a254-4040-8ad3-51f2a3c1a77c", "answer": "Hi", "created_at": 1705398420}\n\n
    ```
    </CodeGroup>
    Структура потоковых фрагментов варьируется в зависимости от `event`:
    - `event: message` LLM возвращает событие текстового фрагмента, т.е. полный текст выводится по частям.
      - `task_id` (string) ID задачи, используется для отслеживания запроса и API остановки генерации ниже
      - `message_id` (string) Уникальный ID сообщения
      - `conversation_id` (string) ID беседы
      - `answer` (string) Содержимое текстового фрагмента, возвращенного LLM
      - `created_at` (int) Временная метка создания, например, 1705395332
    - `event: agent_message` LLM возвращает событие текстового фрагмента, т.е. с включенным Agent Assistant полный текст выводится по частям (Поддерживается только в режиме Agent)
      - `task_id` (string) ID задачи, используется для отслеживания запроса и API остановки генерации ниже
      - `message_id` (string) Уникальный ID сообщения
      - `conversation_id` (string) ID беседы
      - `answer` (string) Содержимое текстового фрагмента, возвращенного LLM
      - `created_at` (int) Временная метка создания, например, 1705395332
    - `event: tts_message` Событие аудиопотока TTS, то есть вывод синтеза речи. Содержимое представляет собой аудиоблок в формате Mp3, закодированный как строка base64. При воспроизведении просто декодируйте base64 и передайте его в плеер. (Это сообщение доступно только при включенном автовоспроизведении)
      - `task_id` (string) ID задачи, используется для отслеживания запроса и интерфейса остановки ответа ниже
      - `message_id` (string) Уникальный ID сообщения
      - `audio` (string) Аудио после синтеза речи, закодированное в текстовом содержимом base64, при воспроизведении просто декодируйте base64 и передайте его в плеер
      - `created_at` (int) Временная метка создания, например: 1705395332
    - `event: tts_message_end` Событие окончания аудиопотока TTS, получение этого события указывает на окончание аудиопотока.
      - `task_id` (string) ID задачи, используется для отслеживания запроса и интерфейса остановки ответа ниже
      - `message_id` (string) Уникальный ID сообщения
      - `audio` (string) Событие окончания не имеет аудио, поэтому это пустая строка
      - `created_at` (int) Временная метка создания, например: 1705395332
    - `event: agent_thought` мысль агента, содержит мысль LLM, вход и выход вызовов инструментов (Поддерживается только в режиме Agent)
      - `id` (string) ID мысли агента, каждая итерация имеет уникальный ID мысли агента
      - `task_id` (string) ID задачи, используется для отслеживания запроса и API остановки генерации ниже
      - `message_id` (string) Уникальный ID сообщения
      - `position` (int) Позиция текущей мысли агента, каждое сообщение может иметь несколько мыслей по порядку.
      - `thought` (string) О чем думает LLM
      - `observation` (string) Ответ от вызовов инструментов
      - `tool` (string) Список инструментов, представляющий, какие инструменты вызываются, разделены точкой с запятой
      - `tool_input` (string) Вход инструментов в формате JSON. Например: `{"dalle3": {"prompt": "a cute cat"}}`.
      - `created_at` (int) Временная метка создания, например, 1705395332
      - `message_files` (array[string]) См. событие message_file
        - `file_id` (string) ID файла
      - `conversation_id` (string) ID беседы
    - `event: message_file` Событие файла сообщения, новый файл создан инструментом
      - `id` (string) Уникальный ID файла
      - `type` (string) Тип файла, в настоящее время допускается только "image"
      - `belongs_to` (string) Принадлежит, здесь это будет только 'assistant'
      - `url` (string) Удаленный URL файла
      - `conversation_id`  (string) ID беседы
    - `event: message_end` Событие окончания сообщения, получение этого события означает, что потоковая передача завершена.
      - `task_id` (string) ID задачи, используется для отслеживания запроса и API остановки генерации ниже
      - `message_id` (string) Уникальный ID сообщения
      - `conversation_id` (string) ID беседы
      - `metadata` (object) Метаданные
        - `usage` (Usage) Информация об использовании модели
        - `retriever_resources` (array[RetrieverResource]) Список цитат и атрибуции
    - `event: message_replace` Событие замены содержимого сообщения.
      Когда включена модерация выходного содержимого, если содержимое помечено, то содержимое сообщения будет заменено предустановленным ответом через это событие.
      - `task_id` (string) ID задачи, используется для отслеживания запроса и API остановки генерации ниже
      - `message_id` (string) Уникальный ID сообщения
      - `conversation_id` (string) ID беседы
      - `answer` (string) Заменяющее содержимое (напрямую заменяет весь текст ответа LLM)
      - `created_at` (int) Временная метка создания, например, 1705395332
    - `event: error`
      Исключения, возникающие в процессе потоковой передачи, будут выводиться в виде потоковых событий, и получение события ошибки завершит поток.
      - `task_id` (string) ID задачи, используется для отслеживания запроса и API остановки генерации ниже
      - `message_id` (string) Уникальный ID сообщения
      - `status` (int) HTTP код состояния
      - `code` (string) Код ошибки
      - `message` (string) Сообщение об ошибке
    - `event: ping` Событие ping каждые 10 секунд для поддержания соединения активным.

    ### Ошибки
    - 404, Беседа не существует
    - 400, `invalid_param`, аномальный ввод параметров
    - 400, `app_unavailable`, Конфигурация приложения недоступна
    - 400, `provider_not_initialize`, нет доступной конфигурации учетных данных модели
    - 400, `provider_quota_exceeded`, квота вызова модели недостаточна
    - 400, `model_currently_not_support`, текущая модель недоступна
    - 400, `completion_request_error`, генерация текста не удалась
    - 500, внутренняя ошибка сервера

  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="POST" label="/chat-messages" targetCode={`curl -X POST '${props.appDetail.api_base_url}/chat-messages' \\\n--header 'Authorization: Bearer {api_key}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\n    "inputs": ${JSON.stringify(props.inputs)},\n    "query": "What are the specs of the iPhone 13 Pro Max?",\n    "response_mode": "streaming",\n    "conversation_id": "",\n    "user": "abc-123",\n    "files": [\n      {\n        "type": "image",\n        "transfer_method": "remote_url",\n        "url": "https://cloud.shai.ai/logo/logo-site.png"\n      }\n    ]\n}'`}>

    ```bash {{ title: 'cURL' }}
    curl -X POST '${props.appDetail.api_base_url}/chat-messages' \
    --header 'Authorization: Bearer {api_key}' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "inputs": {},
        "query": "eh",
        "response_mode": "streaming",
        "conversation_id": "1c7e55fb-1ba2-4e10-81b5-30addcea2276",
        "user": "abc-123"
    }'
    ```
    </CodeGroup>
    ### Блокирующий режим
    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
        "event": "message",
        "task_id": "c3800678-a077-43df-a102-53f23ed20b88", 
        "id": "9da23599-e713-473b-982c-4328d4f5c78a",
        "message_id": "9da23599-e713-473b-982c-4328d4f5c78a",
        "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2",
        "mode": "chat",
        "answer": "iPhone 13 Pro Max specs are listed here:...",
        "metadata": {
            "usage": {
                "prompt_tokens": 1033,
                "prompt_unit_price": "0.001",
                "prompt_price_unit": "0.001",
                "prompt_price": "0.0010330",
                "completion_tokens": 128,
                "completion_unit_price": "0.002",
                "completion_price_unit": "0.001",
                "completion_price": "0.0002560",
                "total_tokens": 1161,
                "total_price": "0.0012890",
                "currency": "USD",
                "latency": 0.7682376249867957
            },
            "retriever_resources": [
                {
                    "position": 1,
                    "dataset_id": "101b4c97-fc2e-463c-90b1-5261a4cdcafb",
                    "dataset_name": "iPhone",
                    "document_id": "8dd1ad74-0b5f-4175-b735-7d98bbbb4e00",
                    "document_name": "iPhone List",
                    "segment_id": "ed599c7f-2766-4294-9d1d-e5235a61270a",
                    "score": 0.98457545,
                    "content": "\"Model\",\"Release Date\",\"Display Size\",\"Resolution\",\"Processor\",\"RAM\",\"Storage\",\"Camera\",\"Battery\",\"Operating System\"\n\"iPhone 13 Pro Max\",\"September 24, 2021\",\"6.7 inch\",\"1284 x 2778\",\"Hexa-core (2x3.23 GHz Avalanche + 4x1.82 GHz Blizzard)\",\"6 GB\",\"128, 256, 512 GB, 1TB\",\"12 MP\",\"4352 mAh\",\"iOS 15\""
                }
            ]
        },
        "created_at": 1705407629
    }
    ```
    </CodeGroup>
    ### Режим потоковой передачи (Базовый помощник)
    <CodeGroup title="Ответ">
    ```streaming {{ title: 'Response' }}
      data: {"event": "message", "message_id": "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " I", "created_at": 1679586595}
      data: {"event": "message", "message_id": "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": "'m", "created_at": 1679586595}
      data: {"event": "message", "message_id": "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " glad", "created_at": 1679586595}
      data: {"event": "message", "message_id": "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " to", "created_at": 1679586595}
      data: {"event": "message", "message_id" : "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " meet", "created_at": 1679586595}
      data: {"event": "message", "message_id" : "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " you", "created_at": 1679586595}
      data: {"event": "message_end", "id": "5e52ce04-874b-4d27-9045-b3bc80def685", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "metadata": {"usage": {"prompt_tokens": 1033, "prompt_unit_price": "0.001", "prompt_price_unit": "0.001", "prompt_price": "0.0010330", "completion_tokens": 135, "completion_unit_price": "0.002", "completion_price_unit": "0.001", "completion_price": "0.0002700", "total_tokens": 1168, "total_price": "0.0013030", "currency": "USD", "latency": 1.381760165997548}, "retriever_resources": [{"position": 1, "dataset_id": "101b4c97-fc2e-463c-90b1-5261a4cdcafb", "dataset_name": "iPhone", "document_id": "8dd1ad74-0b5f-4175-b735-7d98bbbb4e00", "document_name": "iPhone List", "segment_id": "ed599c7f-2766-4294-9d1d-e5235a61270a", "score": 0.98457545, "content": "\"Model\",\"Release Date\",\"Display Size\",\"Resolution\",\"Processor\",\"RAM\",\"Storage\",\"Camera\",\"Battery\",\"Operating System\"\n\"iPhone 13 Pro Max\",\"September 24, 2021\",\"6.7 inch\",\"1284 x 2778\",\"Hexa-core (2x3.23 GHz Avalanche + 4x1.82 GHz Blizzard)\",\"6 GB\",\"128, 256, 512 GB, 1TB\",\"12 MP\",\"4352 mAh\",\"iOS 15\""}]}}
      data: {"event": "tts_message", "conversation_id": "23dd85f3-1a41-4ea0-b7a9-062734ccfaf9", "message_id": "a8bdc41c-13b2-4c18-bfd9-054b9803038c", "created_at": 1721205487, "task_id": "3bf8a0bb-e73b-4690-9e66-4e429bad8ee7", "audio": "qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"}
      data: {"event": "tts_message_end", "conversation_id": "23dd85f3-1a41-4ea0-b7a9-062734ccfaf9", "message_id": "a8bdc41c-13b2-4c18-bfd9-054b9803038c", "created_at": 1721205487, "task_id": "3bf8a0bb-e73b-4690-9e66-4e429bad8ee7", "audio": ""}
    ```
    </CodeGroup>
    ### Пример ответа (Agent Assistant)
    <CodeGroup title="Ответ">
    ```streaming {{ title: 'Response' }}
    data: {"event": "message", "message_id": "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " I", "created_at": 1679586595}
    data: {"event": "message", "message_id": "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": "'m", "created_at": 1679586595}
    data: {"event": "message", "message_id": "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " glad", "created_at": 1679586595}
    data: {"event": "message", "message_id": "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " to", "created_at": 1679586595}
    data: {"event": "message", "message_id" : "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " meet", "created_at": 1679586595}
    data: {"event": "message", "message_id" : "5ad4cb98-f0c7-4085-b384-88c403be6290", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "answer": " you", "created_at": 1679586595}
    data: {"event": "message_end", "id": "5e52ce04-874b-4d27-9045-b3bc80def685", "conversation_id": "45701982-8118-4bc5-8e9b-64562b4555f2", "metadata": {"usage": {"prompt_tokens": 1033, "prompt_unit_price": "0.001", "prompt_price_unit": "0.001", "prompt_price": "0.0010330", "completion_tokens": 135, "completion_unit_price": "0.002", "completion_price_unit": "0.001", "completion_price": "0.0002700", "total_tokens": 1168, "total_price": "0.0013030", "currency": "USD", "latency": 1.381760165997548}, "retriever_resources": [{"position": 1, "dataset_id": "101b4c97-fc2e-463c-90b1-5261a4cdcafb", "dataset_name": "iPhone", "document_id": "8dd1ad74-0b5f-4175-b735-7d98bbbb4e00", "document_name": "iPhone List", "segment_id": "ed599c7f-2766-4294-9d1d-e5235a61270a", "score": 0.98457545, "content": "\"Model\",\"Release Date\",\"Display Size\",\"Resolution\",\"Processor\",\"RAM\",\"Storage\",\"Camera\",\"Battery\",\"Operating System\"\n\"iPhone 13 Pro Max\",\"September 24, 2021\",\"6.7 inch\",\"1284 x 2778\",\"Hexa-core (2x3.23 GHz Avalanche + 4x1.82 GHz Blizzard)\",\"6 GB\",\"128, 256, 512 GB, 1TB\",\"12 MP\",\"4352 mAh\",\"iOS 15\""}]}}
    data: {"event": "tts_message", "conversation_id": "23dd85f3-1a41-4ea0-b7a9-062734ccfaf9", "message_id": "a8bdc41c-13b2-4c18-bfd9-054b9803038c", "created_at": 1721205487, "task_id": "3bf8a0bb-e73b-4690-9e66-4e429bad8ee7", "audio": "qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"}
    data: {"event": "tts_message_end", "conversation_id": "23dd85f3-1a41-4ea0-b7a9-062734ccfaf9", "message_id": "a8bdc41c-13b2-4c18-bfd9-054b9803038c", "created_at": 1721205487, "task_id": "3bf8a0bb-e73b-4690-9e66-4e429bad8ee7", "audio": ""}
  ```
    </CodeGroup>
  </Col>
</Row>

---
<Heading
  url='/files/upload'
  method='POST'
  title='Загрузка файла'
  name='#file-upload'
/>
<Row>
  <Col>
  Загрузить файл (в настоящее время поддерживаются только изображения) для использования при отправке сообщений, обеспечивая мультимодальное понимание изображений и текста.
  Поддерживает форматы png, jpg, jpeg, webp, gif.
  Загруженные файлы предназначены только для использования текущим конечным пользователем.

  ### Тело запроса
  Этот интерфейс требует запрос `multipart/form-data`.
  - `file` (File) Обязательно
    Файл для загрузки.
  - `user` (string) Обязательно
    Идентификатор пользователя, определенный правилами разработчика, должен быть уникальным в рамках приложения.

  ### Ответ
  После успешной загрузки сервер вернет ID файла и связанную информацию.
  - `id` (uuid) ID
  - `name` (string) Имя файла
  - `size` (int) Размер файла (байты)
  - `extension` (string) Расширение файла
  - `mime_type` (string) MIME-тип файла
  - `created_by` (uuid) ID конечного пользователя
  - `created_at` (timestamp) Временная метка создания, например, 1705395332

  ### Ошибки
  - 400, `no_file_uploaded`, файл должен быть предоставлен
  - 400, `too_many_files`, в настоящее время принимается только один файл
  - 400, `unsupported_preview`, файл не поддерживает предпросмотр
  - 400, `unsupported_estimate`, файл не поддерживает оценку
  - 413, `file_too_large`, файл слишком большой
  - 415, `unsupported_file_type`, неподдерживаемое расширение, в настоящее время принимаются только файлы документов
  - 503, `s3_connection_failed`, не удалось подключиться к сервису S3
  - 503, `s3_permission_denied`, нет разрешения на загрузку файлов в S3
  - 503, `s3_file_too_large`, файл превышает лимит размера S3
  - 500, внутренняя ошибка сервера


  </Col>
  <Col sticky>
  ### Пример запроса
  <CodeGroup title="Request" tag="POST" label="/files/upload" targetCode={`curl -X POST '${props.appDetail.api_base_url}/files/upload' \\\n--header 'Authorization: Bearer {api_key}' \\\n--form 'file=@localfile;type=image/[png|jpeg|jpg|webp|gif]' \\\n--form 'user=abc-123'`}>

    ```bash {{ title: 'cURL' }}
    curl -X POST '${props.appDetail.api_base_url}/files/upload' \
    --header 'Authorization: Bearer {api_key}' \
    --form 'file=@"/path/to/file"'
    ```

    </CodeGroup>


  ### Пример ответа
  <CodeGroup title="Response">
    ```json {{ title: 'Response' }}
    {
      "id": "72fa9618-8f89-4a37-9b33-7e1178a24a67",
      "name": "example.png",
      "size": 1024,
      "extension": "png",
      "mime_type": "image/png",
      "created_by": "6ad1ab0a-73ff-4ac1-b9e4-cdb312f71f13",
      "created_at": 1577836800,
    }
  ```
  </CodeGroup>
  </Col>
</Row>
---

<Heading
  url='/chat-messages/:task_id/stop'
  method='POST'
  title='Остановить генерацию'
  name='#stop-generatebacks'
/>
<Row>
  <Col>
  Поддерживается только в режиме потоковой передачи.
  ### Путь
  - `task_id` (string) ID задачи, может быть получен из возвращаемого потокового фрагмента
  ### Тело запроса
  - `user` (string) Обязательно
    Идентификатор пользователя, используется для определения личности конечного пользователя, должен совпадать с пользователем, переданным в интерфейсе отправки сообщения.
  ### Ответ
  - `result` (string) Всегда возвращает "success"
  </Col>
  <Col sticky>
  ### Пример запроса
  <CodeGroup title="Request" tag="POST" label="/chat-messages/:task_id/stop" targetCode={`curl -X POST '${props.appDetail.api_base_url}/chat-messages/:task_id/stop' \\\n-H 'Authorization: Bearer {api_key}' \\\n-H 'Content-Type: application/json' \\\n--data-raw '{"user": "abc-123"}'`}>
    ```bash {{ title: 'cURL' }}
    curl -X POST '${props.appDetail.api_base_url}/chat-messages/:task_id/stop' \
    -H 'Authorization: Bearer {api_key}' \
    -H 'Content-Type: application/json' \
    --data-raw '{
        "user": "abc-123"
    }'
    ```
    </CodeGroup>

    ### Пример ответа
    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "result": "success"
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

<Heading
  url='/messages/:message_id/feedbacks'
  method='POST'
  title='Обратная связь по сообщению'
  name='#feedbacks'
/>
<Row>
  <Col>
    Конечные пользователи могут предоставлять сообщения обратной связи, что помогает разработчикам приложений оптимизировать ожидаемые результаты.

    ### Путь
    <Properties>
      <Property name='message_id' type='string' key='message_id'>
       ID сообщения
      </Property>
    </Properties>

    ### Тело запроса

    <Properties>
      <Property name='rating' type='string' key='rating'>
        Положительная оценка как `like`, отрицательная оценка как `dislike`, отмена положительной оценки как `null`
      </Property>
      <Property name='user' type='string' key='user'>
        Идентификатор пользователя, определенный правилами разработчика, должен быть уникальным в рамках приложения.
      </Property>
      <Property name='content' type='string' key='content'>
        Конкретное содержимое обратной связи по сообщению.
      </Property>
    </Properties>

    ### Ответ
    - `result` (string) Всегда возвращает "success"
  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="POST" label="/messages/:message_id/feedbacks" targetCode={`curl -X POST '${props.appDetail.api_base_url}/messages/:message_id/feedbacks \\\n --header 'Authorization: Bearer {api_key}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\n    "rating": "like",\n    "user": "abc-123",\n    "content": "message feedback information"\n}'`}>

    ```bash {{ title: 'cURL' }}
    curl -X POST '${props.appDetail.api_base_url}/messages/:message_id/feedbacks' \
    --header 'Authorization: Bearer {api_key}' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "rating": "like",
        "user": "abc-123",
        "content": "message feedback information"
    }'
    ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "result": "success"
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

<Heading
  url='/app/feedbacks'
  method='GET'
  title='Получить отзывы приложения'
  name='#app-feedbacks'
/>
<Row>
  <Col>
    Получить отзывы приложения.

    ### Запрос
    <Properties>
      <Property name='page' type='string' key='page'>
       （необязательно）пагинация，по умолчанию：1
      </Property>
    </Properties>

    <Properties>
      <Property name='limit' type='string' key='limit'>
       （необязательно） записей на странице по умолчанию：20
      </Property>
    </Properties>

    ### Ответ
    - `data` (List) возвращает список отзывов приложений.
  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="GET" label="/app/feedbacks" targetCode={`curl -X GET '${props.appDetail.api_base_url}/app/feedbacks?page=1&limit=20'`}>

    ```bash {{ title: 'cURL' }}
    curl -X GET '${props.appDetail.api_base_url}/app/feedbacks?page=1&limit=20' \
    --header 'Authorization: Bearer {api_key}' \
    --header 'Content-Type: application/json'
    ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
      {
          "data": [
              {
                  "id": "8c0fbed8-e2f9-49ff-9f0e-15a35bdd0e25",
                  "app_id": "f252d396-fe48-450e-94ec-e184218e7346",
                  "conversation_id": "2397604b-9deb-430e-b285-4726e51fd62d",
                  "message_id": "709c0b0f-0a96-4a4e-91a4-ec0889937b11",
                  "rating": "like",
                  "content": "message feedback information-3",
                  "from_source": "user",
                  "from_end_user_id": "74286412-9a1a-42c1-929c-01edb1d381d5",
                  "from_account_id": null,
                  "created_at": "2025-04-24T09:24:38",
                  "updated_at": "2025-04-24T09:24:38"
              }
          ]
      }
    ```
    </CodeGroup>
  </Col>
</Row>
---

<Heading
  url='/messages/{message_id}/suggested'
  method='GET'
  title='Следующие предлагаемые вопросы'
  name='#suggested'
/>
<Row>
  <Col>
    Получить предложения следующих вопросов для текущего сообщения

    ### Параметры пути

    <Properties>
      <Property name='message_id' type='string' key='message_id'>
        ID сообщения
      </Property>
    </Properties>

    ### Запрос
    <Properties>
      <Property name='user' type='string' key='user'>
        Идентификатор пользователя, используется для определения личности конечного пользователя для поиска и статистики.
        Должен быть уникально определен разработчиком в рамках приложения.
      </Property>
    </Properties>
  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="GET" label="/messages/{message_id}/suggested" targetCode={`curl --location --request GET '${props.appDetail.api_base_url}/messages/{message_id}/suggested?user=abc-123& \\\n--header 'Authorization: Bearer ENTER-YOUR-SECRET-KEY' \\\n--header 'Content-Type: application/json'`}>

    ```bash {{ title: 'cURL' }}
    curl --location --request GET '${props.appDetail.api_base_url}/messages/{message_id}/suggested' \
    --header 'Authorization: Bearer ENTER-YOUR-SECRET-KEY' \
    --header 'Content-Type: application/json' \
    ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "result": "success",
      "data": [
            "a",
            "b",
            "c"
        ]
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

<Heading
  url='/messages'
  method='GET'
  title='Получить исторические сообщения беседы'
  name='#messages'
/>
<Row>
  <Col>
    Возвращает исторические записи чата в формате прокручиваемой загрузки, первая страница возвращает последние `{limit}` сообщений, т.е. в обратном порядке.

    ### Запрос

    <Properties>
      <Property name='conversation_id' type='string' key='conversation_id'>
        ID беседы
      </Property>
      <Property name='user' type='string' key='user'>
        Идентификатор пользователя, используется для определения личности конечного пользователя для поиска и статистики.
        Должен быть уникально определен разработчиком в рамках приложения.
      </Property>
      <Property name='first_id' type='string' key='first_id'>
          ID первой записи чата на текущей странице, по умолчанию null.
      </Property>
      <Property name='limit' type='int' key='limit'>
          Сколько сообщений истории чата вернуть в одном запросе, по умолчанию 20.
      </Property>
    </Properties>

    ### Ответ
    - `data` (array[object]) Список сообщений
      - `id` (string) ID сообщения
      - `conversation_id` (string) ID беседы
      - `inputs` (object) Параметры ввода пользователя.
      - `query` (string) Содержимое ввода пользователя / вопроса.
      - `message_files` (array[object]) Файлы сообщения
        - `id` (string) ID
        - `type` (string) Тип файла, image для изображений
        - `url` (string) URL предпросмотра изображения
        - `belongs_to` (string) принадлежит, user или assistant
      - `agent_thoughts` (array[object]) Мысли агента（Пусто, если это Базовый помощник）
        - `id` (string) ID мысли агента, каждая итерация имеет уникальный ID мысли агента
        - `message_id` (string) Уникальный ID сообщения
        - `position` (int) Позиция текущей мысли агента, каждое сообщение может иметь несколько мыслей по порядку.
        - `thought` (string) О чем думает LLM
        - `observation` (string) Ответ от вызовов инструментов
        - `tool` (string) Список инструментов, представляющий, какие инструменты вызываются, разделены точкой с запятой
        - `tool_input` (string) Вход инструментов в формате JSON. Например: `{"dalle3": {"prompt": "a cute cat"}}`.
        - `created_at` (int) Временная метка создания, например, 1705395332
        - `message_files` (array[string]) См. событие message_file
          - `file_id` (string) ID файла
      - `answer` (string) Содержимое ответного сообщения
      - `created_at` (timestamp) Временная метка создания, например, 1705395332
      - `feedback` (object) Информация об обратной связи
        - `rating` (string) Положительная оценка как `like` / Отрицательная оценка как `dislike`
      - `retriever_resources` (array[RetrieverResource]) Список цитат и атрибуции
    - `has_more` (bool) Есть ли следующая страница
    - `limit` (int) Количество возвращенных элементов, если ввод превышает системный лимит, возвращается системный лимит

  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="GET" label="/messages" targetCode={`curl -X GET '${props.appDetail.api_base_url}/messages?user=abc-123&conversation_id='\\\n --header 'Authorization: Bearer {api_key}'`}>

    ```bash {{ title: 'cURL' }}
    curl -X GET '${props.appDetail.api_base_url}/messages?user=abc-123&conversation_id='
    --header 'Authorization: Bearer {api_key}'
    ```

    </CodeGroup>
    ### Пример ответа (Базовый помощник)
    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "limit": 20,
      "has_more": false,
      "data": [
        {
            "id": "a076a87f-31e5-48dc-b452-0061adbbc922",
            "conversation_id": "cd78daf6-f9e4-4463-9ff2-54257230a0ce",
            "inputs": {
                "name": "shai"
            },
            "query": "iphone 13 pro",
            "answer": "The iPhone 13 Pro, released on September 24, 2021, features a 6.1-inch display with a resolution of 1170 x 2532. It is equipped with a Hexa-core (2x3.23 GHz Avalanche + 4x1.82 GHz Blizzard) processor, 6 GB of RAM, and offers storage options of 128 GB, 256 GB, 512 GB, and 1 TB. The camera is 12 MP, the battery capacity is 3095 mAh, and it runs on iOS 15.",
            "message_files": [],
            "feedback": null,
            "retriever_resources": [
                {
                    "position": 1,
                    "dataset_id": "101b4c97-fc2e-463c-90b1-5261a4cdcafb",
                    "dataset_name": "iPhone",
                    "document_id": "8dd1ad74-0b5f-4175-b735-7d98bbbb4e00",
                    "document_name": "iPhone List",
                    "segment_id": "ed599c7f-2766-4294-9d1d-e5235a61270a",
                    "score": 0.98457545,
                    "content": "\"Model\",\"Release Date\",\"Display Size\",\"Resolution\",\"Processor\",\"RAM\",\"Storage\",\"Camera\",\"Battery\",\"Operating System\"\n\"iPhone 13 Pro Max\",\"September 24, 2021\",\"6.7 inch\",\"1284 x 2778\",\"Hexa-core (2x3.23 GHz Avalanche + 4x1.82 GHz Blizzard)\",\"6 GB\",\"128, 256, 512 GB, 1TB\",\"12 MP\",\"4352 mAh\",\"iOS 15\""
                }
            ],
            "agent_thoughts": [],
            "created_at": 1705569239,
        }
      ]
    }
    ```
    </CodeGroup>

    ### Пример ответа (Agent Assistant)
    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
        "limit": 20,
        "has_more": false,
        "data": [
            {
                "id": "d35e006c-7c4d-458f-9142-be4930abdf94",
                "conversation_id": "957c068b-f258-4f89-ba10-6e8a0361c457",
                "inputs": {},
                "query": "draw a cat",
                "answer": "I have generated an image of a cat for you. Please check your messages to view the image.",
                "message_files": [
                    {
                        "id": "976990d2-5294-47e6-8f14-7356ba9d2d76",
                        "type": "image",
                        "url": "http://127.0.0.1:5001/files/tools/976990d2-5294-47e6-8f14-7356ba9d2d76.png?timestamp=1705988524&nonce=55df3f9f7311a9acd91bf074cd524092&sign=z43nMSO1L2HBvoqADLkRxr7Biz0fkjeDstnJiCK1zh8=",
                        "belongs_to": "assistant"
                    }
                ],
                "feedback": null,
                "retriever_resources": [],
                "created_at": 1705988187,
                "agent_thoughts": [
                    {
                        "id": "592c84cf-07ee-441c-9dcc-ffc66c033469",
                        "chain_id": null,
                        "message_id": "d35e006c-7c4d-458f-9142-be4930abdf94",
                        "position": 1,
                        "thought": "",
                        "tool": "dalle2",
                        "tool_input": "{\"dalle2\": {\"prompt\": \"cat\"}}",
                        "created_at": 1705988186,
                        "observation": "image has been created and sent to user already, you should tell user to check it now.",
                        "files": [
                            "976990d2-5294-47e6-8f14-7356ba9d2d76"
                        ]
                    },
                    {
                        "id": "73ead60d-2370-4780-b5ed-532d2762b0e5",
                        "chain_id": null,
                        "message_id": "d35e006c-7c4d-458f-9142-be4930abdf94",
                        "position": 2,
                        "thought": "I have generated an image of a cat for you. Please check your messages to view the image.",
                        "tool": "",
                        "tool_input": "",
                        "created_at": 1705988199,
                        "observation": "",
                        "files": []
                    }
                ]
            }
        ]
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

<Heading
  url='/conversations'
  method='GET'
  title='Получить беседы'
  name='#conversations'
/>
<Row>
  <Col>
    Получить список бесед для текущего пользователя, по умолчанию последние 20 записей.

    ### Запрос

    <Properties>
      <Property name='user' type='string' key='user'>
          Идентификатор пользователя, используется для определения личности конечного пользователя для поиска и статистики.
          Должен быть уникально определен разработчиком в рамках приложения.
      </Property>
      <Property name='last_id' type='string' key='last_id'>
          (Необязательно) ID последней записи на текущей странице, по умолчанию null.
      </Property>
      <Property name='limit' type='int' key='limit'>
          (Необязательно) Сколько записей вернуть в одном запросе, по умолчанию последние 20 записей. Максимум 100, минимум 1.
      </Property>
      <Property name='sort_by' type='string' key='sort_by'>
        (Необязательно) Поле сортировки, По умолчанию: -updated_at (отсортировано в порядке убывания по времени обновления)
        - Доступные значения: created_at, -created_at, updated_at, -updated_at
        - Символ перед полем представляет порядок или обратный порядок, "-" представляет обратный порядок.
      </Property>
    </Properties>

    ### Ответ
    - `data` (array[object]) Список бесед
      - `id` (string) ID беседы
      - `name` (string) Имя беседы, по умолчанию это фрагмент первого вопроса, заданного пользователем в беседе.
      - `inputs` (object) Параметры ввода пользователя.
      - `status` (string) Статус беседы
      - `introduction` (string) Введение
      - `created_at` (timestamp) Временная метка создания, например, 1705395332
      - `updated_at` (timestamp) Временная метка обновления, например, 1705395332
    - `has_more` (bool)
    - `limit` (int) Количество возвращенных записей, если ввод превышает системный лимит, возвращается системный лимит

  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="GET" label="/conversations" targetCode={`curl -X GET '${props.appDetail.api_base_url}/conversations?user=abc-123&last_id=&limit=20' \\\n --header 'Authorization: Bearer {api_key}'`}>

    ```bash {{ title: 'cURL' }}
    curl -X GET '${props.appDetail.api_base_url}/conversations?user=abc-123&last_id=&limit=20' \
    --header 'Authorization: Bearer {api_key}'
    ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "limit": 20,
      "has_more": false,
      "data": [
        {
          "id": "10799fb8-64f7-4296-bbf7-b42bfbe0ae54",
          "name": "New chat",
          "inputs": {
              "book": "book",
              "myName": "Lucy"
          },
          "status": "normal",
          "created_at": 1679667915,
          "updated_at": 1679667915
        },
        {
          "id": "hSIhXBhNe8X1d8Et"
          // ...
        }
      ]
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

<Heading
  url='/conversations/:conversation_id'
  method='DELETE'
  title='Удалить беседу'
  name='#delete'
/>
<Row>
  <Col>
    Удалить беседу.

    ### Путь
    - `conversation_id` (string) ID беседы

    ### Тело запроса

    <Properties>
      <Property name='user' type='string' key='user'>
        Идентификатор пользователя, определенный разработчиком, должен обеспечивать уникальность в рамках приложения.
      </Property>
    </Properties>

    ### Ответ
    - `result` (string) Всегда возвращает "success"
  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="DELETE" label="/conversations/:conversation_id" targetCode={`curl -X DELETE '${props.appDetail.api_base_url}/conversations/:conversation_id' \\\n--header 'Authorization: Bearer {api_key}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{ \n "user": "abc-123"\n}'`}>

    ```bash {{ title: 'cURL' }}
        curl -X DELETE '${props.appDetail.api_base_url}/conversations/{conversation_id}' \
        --header 'Content-Type: application/json' \
        --header 'Accept: application/json' \
        --header 'Authorization: Bearer {api_key}' \
        --data '{
            "user": "abc-123"
        }'
      ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```text {{ title: 'Response' }}
    204 No Content
    ```
    </CodeGroup>
  </Col>
</Row>

---
<Heading
  url='/conversations/:conversation_id/name'
  method='POST'
  title='Переименовать беседу'
  name='#rename'
/>
<Row>
  <Col>
    ### Тело запроса
    Переименовать сессию, имя сессии используется для отображения на клиентах, которые поддерживают несколько сессий.

    ### Путь
    - `conversation_id` (string) ID беседы

    <Properties>
      <Property name='name' type='string' key='name'>
        (Необязательно) Имя беседы. Этот параметр может быть опущен, если `auto_generate` установлен в `true`.
      </Property>
      <Property name='auto_generate' type='bool' key='auto_generate'>
        (Необязательно) Автоматически генерировать заголовок, по умолчанию `false`
      </Property>
      <Property name='user' type='string' key='user'>
        Идентификатор пользователя, определенный разработчиком, должен обеспечивать уникальность в рамках приложения.
      </Property>
    </Properties>

    ### Ответ
    - `id` (string) ID беседы
    - `name` (string) Имя беседы
    - `inputs` (object) Параметры ввода пользователя
    - `status` (string) Статус беседы
    - `introduction` (string) Введение
    - `created_at` (timestamp) Временная метка создания, например, 1705395332
    - `updated_at` (timestamp) Временная метка обновления, например, 1705395332
  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="POST" label="/conversations/:conversation_id/name" targetCode={`curl -X POST '${props.appDetail.api_base_url}/conversations/:conversation_id/name' \\\n--header 'Authorization: Bearer {api_key}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{ \n "name": "", \n "auto_generate": true, \n "user": "abc-123"\n}'`}>

    ```bash {{ title: 'cURL' }}
    curl -X POST '${props.appDetail.api_base_url}/conversations/{conversation_id}/name' \
    --header 'Content-Type: application/json' \
    --header 'Authorization: Bearer {api_key}' \
    --data-raw '{
        "name": "",
        "auto_generate": true,
        "user": "abc-123"
    }'
    ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
        "id": "cd78daf6-f9e4-4463-9ff2-54257230a0ce",
        "name": "Chat vs AI",
        "inputs": {},
        "status": "normal",
        "introduction": "",
        "created_at": 1705569238,
        "updated_at": 1705569238
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

<Heading
  url='/conversations/:conversation_id/variables'
  method='GET'
  title='Получить переменные беседы'
  name='#conversation-variables'
/>
<Row>
  <Col>
    Получить переменные из конкретной беседы. Этот endpoint полезен для извлечения структурированных данных, которые были захвачены во время беседы.

    ### Параметры пути

    <Properties>
      <Property name='conversation_id' type='string' key='conversation_id'>
        ID беседы, из которой нужно получить переменные.
      </Property>
    </Properties>

    ### Параметры запроса

    <Properties>
      <Property name='user' type='string' key='user'>
        Идентификатор пользователя, определенный разработчиком, должен обеспечивать уникальность в рамках приложения
      </Property>
      <Property name='last_id' type='string' key='last_id'>
          (Необязательно) ID последней записи на текущей странице, по умолчанию null.
      </Property>
      <Property name='limit' type='int' key='limit'>
          (Необязательно) Сколько записей вернуть в одном запросе, по умолчанию последние 20 записей. Максимум 100, минимум 1.
      </Property>
    </Properties>

    ### Ответ

    - `limit` (int) Количество элементов на странице
    - `has_more` (bool) Есть ли следующая страница
    - `data` (array[object]) Список переменных
      - `id` (string) ID переменной
      - `name` (string) Имя переменной
      - `value_type` (string) Тип переменной (string, number, object, и т.д.)
      - `value` (string) Значение переменной
      - `description` (string) Описание переменной
      - `created_at` (int) Временная метка создания
      - `updated_at` (int) Временная метка последнего обновления

    ### Ошибки
    - 404, `conversation_not_exists`, Беседа не найдена

  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="GET" label="/conversations/:conversation_id/variables" targetCode={`curl -X GET '${props.appDetail.api_base_url}/conversations/{conversation_id}/variables?user=abc-123' \\\n--header 'Authorization: Bearer {api_key}'`}>

    ```bash {{ title: 'cURL' }}
    curl -X GET '${props.appDetail.api_base_url}/conversations/{conversation_id}/variables?user=abc-123' \
    --header 'Authorization: Bearer {api_key}'
    ```

    </CodeGroup>

    <CodeGroup title="Запрос с фильтром по имени переменной">
    ```bash {{ title: 'cURL' }}
    curl -X GET '${props.appDetail.api_base_url}/conversations/{conversation_id}/variables?user=abc-123&variable_name=customer_name' \
    --header 'Authorization: Bearer {api_key}'
    ```
    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "limit": 100,
      "has_more": false,
      "data": [
        {
          "id": "variable-uuid-1",
          "name": "customer_name",
          "value_type": "string",
          "value": "John Doe",
          "description": "Customer name extracted from the conversation",
          "created_at": 1650000000000,
          "updated_at": 1650000000000
        },
        {
          "id": "variable-uuid-2",
          "name": "order_details",
          "value_type": "json",
          "value": "{\"product\":\"Widget\",\"quantity\":5,\"price\":19.99}",
          "description": "Order details from the customer",
          "created_at": 1650000000000,
          "updated_at": 1650000000000
        }
      ]
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

<Heading
  url='/audio-to-text'
  method='POST'
  title='Речь в текст'
  name='#audio'
/>
<Row>
  <Col>
    Этот endpoint требует запрос multipart/form-data.

    ### Тело запроса

    <Properties>
      <Property name='file' type='file' key='file'>
        Аудиофайл.
        Поддерживаемые форматы: `['mp3', 'mp4', 'mpeg', 'mpga', 'm4a', 'wav', 'webm']`
        Лимит размера файла: 15MB
      </Property>
      <Property name='user' type='string' key='user'>
      Идентификатор пользователя, определенный правилами разработчика, должен быть уникальным в рамках приложения.
      </Property>
    </Properties>

    ### Ответ
    - `text` (string) Выходной текст

  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="POST" label="/audio-to-text" targetCode={`curl -X POST '${props.appDetail.api_base_url}/audio-to-text' \\\n--header 'Authorization: Bearer {api_key}' \\\n--form 'file=@localfile;type=audio/[mp3|mp4|mpeg|mpga|m4a|wav|webm]'`}>

    ```bash {{ title: 'cURL' }}
    curl -X POST '${props.appDetail.api_base_url}/conversations/name' \
    --header 'Authorization: Bearer {api_key}' \
    --form 'file=@localfile;type=audio/mp3'
    ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "text": ""
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

<Heading
  url='/text-to-audio'
  method='POST'
  title='Текст в аудио'
  name='#audio'
/>
<Row>
  <Col>
    Преобразование текста в речь.

    ### Тело запроса

    <Properties>
      <Property name='message_id' type='str' key='message_id'>
        Для текстовых сообщений, сгенерированных Shai, просто передайте сгенерированный message-id напрямую. Серверная часть будет использовать message-id для поиска соответствующего содержимого и синтезировать голосовую информацию напрямую. Если message_id и text предоставлены одновременно, приоритет отдается message_id.
      </Property>
      <Property name='text' type='str' key='text'>
        Содержимое для генерации речи。
      </Property>
      <Property name='user' type='string' key='user'>
        Идентификатор пользователя, определенный разработчиком, должен обеспечивать уникальность в рамках приложения.
      </Property>
    </Properties>
  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="POST" label="/text-to-audio" targetCode={`curl --location --request POST '${props.appDetail.api_base_url}/text-to-audio' \\\n--header 'Authorization: Bearer ENTER-YOUR-SECRET-KEY' \\\n--form 'text=Hello Shai;user=abc-123;message_id=5ad4cb98-f0c7-4085-b384-88c403be6290`}>

    ```bash {{ title: 'cURL' }}
    curl --location --request POST '${props.appDetail.api_base_url}/text-to-audio' \
    --header 'Authorization: Bearer ENTER-YOUR-SECRET-KEY' \
    --form 'file=Hello Shai;user=abc-123;message_id=5ad4cb98-f0c7-4085-b384-88c403be6290'
    ```

    </CodeGroup>

    <CodeGroup title="заголовки">
    ```json {{ title: 'headers' }}
    {
      "Content-Type": "audio/wav"
    }
    ```
    </CodeGroup>
  </Col>
</Row>
---

<Heading
  url='/info'
  method='GET'
  title='Получить базовую информацию о приложении'
  name='#info'
/>
<Row>
  <Col>
  Используется для получения базовой информации об этом приложении

  ### Ответ
  - `name` (string) имя приложения
  - `description` (string) описание приложения
  - `tags` (array[string]) теги приложения
  </Col>
  <Col>
    <CodeGroup title="Запрос" tag="GET" label="/info" targetCode={`curl -X GET '${props.appDetail.api_base_url}/info' \\\n-H 'Authorization: Bearer {api_key}'`}>
      ```bash {{ title: 'cURL' }}
      curl -X GET '${props.appDetail.api_base_url}/info' \
      -H 'Authorization: Bearer {api_key}'
      ```
    </CodeGroup>
    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "name": "My App",
      "description": "This is my app.",
      "tags": [
        "tag1",
        "tag2"
      ]
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

<Heading
  url='/parameters'
  method='GET'
  title='Получить информацию о параметрах приложения'
  name='#parameters'
/>
<Row>
  <Col>
    Используется при входе на страницу для получения информации о функциях, именах входных параметров, типах и значениях по умолчанию.

    ### Запрос

    <Properties>
      <Property name='user' type='string' key='user'>
          Идентификатор пользователя, определенный правилами разработчика, должен быть уникальным в рамках приложения.
      </Property>
    </Properties>

    ### Ответ
    - `opening_statement` (string) Вступительное заявление
    - `suggested_questions` (array[string]) Список предлагаемых вопросов для начала
    - `suggested_questions_after_answer` (object) Предлагать вопросы после включения ответа.
      - `enabled` (bool) Включено ли это
    - `speech_to_text` (object) Речь в текст
      - `enabled` (bool) Включено ли это
    - `text_to_speech` (object) Текст в речь
      - `enabled` (bool) Включено ли это
      - `voice` (string) Тип голоса
      - `language` (string) Язык
      - `autoPlay` (string) Автовоспроизведение
        - `enabled`   Включено
        - `disabled`  Выключено
    - `retriever_resource` (object) Цитаты и атрибуция
      - `enabled` (bool) Включено ли это
    - `annotation_reply` (object) Ответ с аннотацией
      - `enabled` (bool) Включено ли это
    - `user_input_form` (array[object]) Конфигурация формы ввода пользователя
      - `text-input` (object) Элемент управления вводом текста
        - `label` (string) Имя метки отображения переменной
        - `variable` (string) ID переменной
        - `required` (bool) Является ли обязательным
        - `default` (string) Значение по умолчанию
      - `paragraph` (object) Элемент управления вводом текста абзаца
        - `label` (string) Имя метки отображения переменной
        - `variable` (string) ID переменной
        - `required` (bool) Является ли обязательным
        - `default` (string) Значение по умолчанию
      - `select` (object) Элемент управления выпадающим списком
        - `label` (string) Имя метки отображения переменной
        - `variable` (string) ID переменной
        - `required` (bool) Является ли обязательным
        - `default` (string) Значение по умолчанию
        - `options` (array[string]) Значения опций
    - `file_upload` (object) Конфигурация загрузки файлов
      - `image` (object) Настройки изображения
        В настоящее время поддерживаются только типы изображений: `png`, `jpg`, `jpeg`, `webp`, `gif`
        - `enabled` (bool) Включено ли это
        - `number_limits` (int) Лимит количества изображений, по умолчанию 3
        - `transfer_methods` (array[string]) Список способов передачи, remote_url, local_file, необходимо выбрать один
    - `system_parameters` (object) Системные параметры
      - `file_size_limit` (int) Лимит размера загрузки документа (МБ)
      - `image_file_size_limit` (int) Лимит размера загрузки файла изображения (МБ)
      - `audio_file_size_limit` (int) Лимит размера загрузки аудиофайла (МБ)
      - `video_file_size_limit` (int) Лимит размера загрузки видеофайла (МБ)

  </Col>
  <Col sticky>

    <CodeGroup title="Запрос" tag="GET" label="/parameters" targetCode={` curl -X GET '${props.appDetail.api_base_url}/parameters'`}>

    ```bash {{ title: 'cURL' }}
    curl -X GET '${props.appDetail.api_base_url}/parameters' \
    --header 'Authorization: Bearer {api_key}'
    ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "opening_statement": "Hello!",
      "suggested_questions_after_answer": {
          "enabled": true
      },
      "speech_to_text": {
          "enabled": true
      },
      "text_to_speech": {
          "enabled": true,
          "voice": "sambert-zhinan-v1",
          "language": "zh-Hans",
          "autoPlay": "disabled"
      },
      "retriever_resource": {
          "enabled": true
      },
      "annotation_reply": {
          "enabled": true
      },
      "user_input_form": [
          {
              "paragraph": {
                  "label": "Query",
                  "variable": "query",
                  "required": true,
                  "default": ""
              }
          }
      ],
      "file_upload": {
          "image": {
              "enabled": false,
              "number_limits": 3,
              "detail": "high",
              "transfer_methods": [
                  "remote_url",
                  "local_file"
              ]
          }
      },
      "system_parameters": {
          "file_size_limit": 15,
          "image_file_size_limit": 10,
          "audio_file_size_limit": 50,
          "video_file_size_limit": 100
      }
    }
    ```
    </CodeGroup>
  </Col>
</Row>
---

<Heading
  url='/meta'
  method='GET'
  title='Получить мета-информацию приложения'
  name='#meta'
/>
<Row>
  <Col>
  Используется для получения иконок инструментов в этом приложении

  ### Ответ
  - `tool_icons`(object[string]) иконки инструментов
    - `tool_name` (string)
      - `icon` (object|string)
        - (object) объект иконки
          - `background` (string) цвет фона в формате hex
          - `content`(string) эмодзи
        - (string) url иконки
  </Col>
  <Col>
  <CodeGroup title="Request" tag="GET" label="/meta" targetCode={`curl -X GET '${props.appDetail.api_base_url}/meta' \\\n-H 'Authorization: Bearer {api_key}'`}>
    ```bash {{ title: 'cURL' }}
    curl -X GET '${props.appDetail.api_base_url}/meta' \
    -H 'Authorization: Bearer {api_key}'
    ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "tool_icons": {
        "dalle2": "https://cloud.shai.ai/console/api/workspaces/current/tool-provider/builtin/dalle/icon",
        "api_tool": {
          "background": "#252525",
          "content": "\ud83d\ude01"
        }
      }
    }
    ```
    </CodeGroup>
  </Col>
</Row>
---

<Heading
  url='/site'
  method='GET'
  title='Получить настройки WebApp приложения'
  name='#site'
/>
<Row>
  <Col>
  Используется для получения настроек WebApp приложения.
  ### Ответ
  - `title` (string) Имя WebApp
  - `chat_color_theme` (string) Цветовая тема чата, в формате hex
  - `chat_color_theme_inverted` (bool) Инвертирована ли цветовая тема чата
  - `icon_type` (string) Тип иконки, `emoji` - эмодзи, `image` - картинка
  - `icon` (string) Иконка. Если это тип `emoji`, это символ эмодзи; если это тип `image`, это URL изображения
  - `icon_background` (string) Цвет фона в формате hex
  - `icon_url` (string) URL иконки
  - `description` (string) Описание
  - `copyright` (string) Информация об авторских правах
  - `privacy_policy` (string) Ссылка на политику конфиденциальности
  - `custom_disclaimer` (string) Пользовательский отказ от ответственности
  - `default_language` (string) Язык по умолчанию
  - `show_workflow_steps` (bool) Показывать ли детали workflow
  - `use_icon_as_answer_icon` (bool) Заменять ли 🤖 в чате на иконку WebApp
  </Col>
  <Col>
  <CodeGroup title="Request" tag="POST" label="/meta" targetCode={`curl -X GET '${props.appDetail.api_base_url}/site' \\\n-H 'Authorization: Bearer {api_key}'`}>
    ```bash {{ title: 'cURL' }}
    curl -X GET '${props.appDetail.api_base_url}/site' \
    -H 'Authorization: Bearer {api_key}'
    ```

    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "title": "My App",
      "chat_color_theme": "#ff4a4a",
      "chat_color_theme_inverted": false,
      "icon_type": "emoji",
      "icon": "😄",
      "icon_background": "#FFEAD5",
      "icon_url": null,
      "description": "This is my app.",
      "copyright": "all rights reserved",
      "privacy_policy": "",
      "custom_disclaimer": "All generated by AI",
      "default_language": "en-US",
      "show_workflow_steps": false,
      "use_icon_as_answer_icon": false,
    }
    ```
    </CodeGroup>
  </Col>
</Row>
___

<Heading
  url='/apps/annotations'
  method='GET'
  title='Получить список аннотаций'
  name='#annotation_list'
/>
<Row>
  <Col>
    ### Запрос
    <Properties>
      <Property name='page' type='string' key='page'>
        Номер страницы
      </Property>
      <Property name='limit' type='string' key='limit'>
        Количество возвращаемых элементов, по умолчанию 20, диапазон 1-100
      </Property>
    </Properties>
  </Col>
  <Col sticky>
    <CodeGroup
      title="Request"
      tag="GET"
      label="/apps/annotations"
      targetCode={`curl --location --request GET '${props.apiBaseUrl}/apps/annotations?page=1&limit=20' \\\n--header 'Authorization: Bearer {api_key}'`}
    >
    ```bash {{ title: 'cURL' }}
    curl --location --request GET '${props.apiBaseUrl}/apps/annotations?page=1&limit=20' \
    --header 'Authorization: Bearer {api_key}'
    ```
    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "data": [
        {
          "id": "69d48372-ad81-4c75-9c46-2ce197b4d402",
          "question": "What is your name?",
          "answer": "I am Shai.",
          "hit_count": 0,
          "created_at": 1735625869
        }
      ],
      "has_more": false,
      "limit": 20,
      "total": 1,
      "page": 1
    }
    ```
    </CodeGroup>
  </Col>
</Row>
---

<Heading
  url='/apps/annotations'
  method='POST'
  title='Создать аннотацию'
  name='#create_annotation'
/>
<Row>
  <Col>
    ### Запрос
    <Properties>
      <Property name='question' type='string' key='question'>
        Вопрос
      </Property>
      <Property name='answer' type='string' key='answer'>
        Ответ
      </Property>
    </Properties>
  </Col>
  <Col sticky>
    <CodeGroup
      title="Request"
      tag="POST"
      label="/apps/annotations"
      targetCode={`curl --location --request POST '${props.apiBaseUrl}/apps/annotations' \\\n--header 'Authorization: Bearer {api_key}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{"question": "What is your name?","answer": "I am Shai."}'`}
    >
    ```bash {{ title: 'cURL' }}
    curl --location --request POST '${props.apiBaseUrl}/apps/annotations' \
    --header 'Authorization: Bearer {api_key}' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "question": "What is your name?",
        "answer": "I am Shai."
    }'
    ```
    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      {
        "id": "69d48372-ad81-4c75-9c46-2ce197b4d402",
        "question": "What is your name?",
        "answer": "I am Shai.",
        "hit_count": 0,
        "created_at": 1735625869
      }
    }
    ```
    </CodeGroup>
  </Col>
</Row>
---

<Heading
  url='/apps/annotations/{annotation_id}'
  method='PUT'
  title='Обновить аннотацию'
  name='#update_annotation'
/>
<Row>
  <Col>
    ### Запрос
    <Properties>
      <Property name='annotation_id' type='string' key='annotation_id'>
        ID аннотации
      </Property>
      <Property name='question' type='string' key='question'>
        Вопрос
      </Property>
      <Property name='answer' type='string' key='answer'>
        Ответ
      </Property>
    </Properties>
  </Col>
  <Col sticky>
    <CodeGroup
      title="Request"
      tag="PUT"
      label="/apps/annotations/{annotation_id}"
      targetCode={`curl --location --request POST '${props.apiBaseUrl}/apps/annotations/{annotation_id}' \\\n--header 'Authorization: Bearer {api_key}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{"question": "What is your name?","answer": "I am Shai."}'`}
    >
    ```bash {{ title: 'cURL' }}
    curl --location --request POST '${props.apiBaseUrl}/apps/annotations/{annotation_id}' \
    --header 'Authorization: Bearer {api_key}' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "question": "What is your name?",
        "answer": "I am Shai."
    }'
    ```
    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      {
        "id": "69d48372-ad81-4c75-9c46-2ce197b4d402",
        "question": "What is your name?",
        "answer": "I am Shai.",
        "hit_count": 0,
        "created_at": 1735625869
      }
    }
    ```
    </CodeGroup>
  </Col>
</Row>
---

<Heading
  url='/apps/annotations/{annotation_id}'
  method='DELETE'
  title='Удалить аннотацию'
  name='#delete_annotation'
/>
<Row>
  <Col>
    ### Запрос
    <Properties>
      <Property name='annotation_id' type='string' key='annotation_id'>
        ID аннотации
      </Property>
    </Properties>
  </Col>
  <Col sticky>
    <CodeGroup
      title="Request"
      tag="PUT"
      label="/apps/annotations/{annotation_id}"
      targetCode={`curl --location --request DELETE '${props.apiBaseUrl}/apps/annotations/{annotation_id}' \\\n--header 'Authorization: Bearer {api_key}' \\\n--header 'Content-Type: application/json'`}
    >
    ```bash {{ title: 'cURL' }}
    curl --location --request DELETE '${props.apiBaseUrl}/apps/annotations/{annotation_id}' \
    --header 'Authorization: Bearer {api_key}'
    ```
    </CodeGroup>

    <CodeGroup title="Ответ">
    ```text {{ title: 'Response' }}
    204 No Content
    ```
    </CodeGroup>
  </Col>
</Row>
---

<Heading
  url='/apps/annotation-reply/{action}'
  method='POST'
  title='Начальные настройки ответа с аннотацией'
  name='#initial_annotation_reply_settings'
/>
<Row>
  <Col>
    ### Запрос
    <Properties>
      <Property name='action' type='string' key='action'>
        Действие, может быть только 'enable' или 'disable'
      </Property>
      <Property name='embedding_model_provider' type='string' key='embedding_model_provider'>
        Указанный провайдер модели эмбеддинга, должен быть настроен в системе заранее, соответствует полю provider (Необязательно)
      </Property>
      <Property name='embedding_model' type='string' key='embedding_model'>
        Указанная модель эмбеддинга, соответствует полю model (Необязательно)
      </Property>
      <Property name='score_threshold' type='number' key='score_threshold'>
        Порог схожести для сопоставления аннотированных ответов. Только аннотации с оценками выше этого порога будут извлечены.
      </Property>
    </Properties>
  </Col>
  <Col sticky>
    Провайдер и имя модели эмбеддинга можно получить через следующий интерфейс: v1/workspaces/current/models/model-types/text-embedding. Для конкретных инструкций см.: Поддержка базы знаний через API. Используемая авторизация - это токен API набора данных.
    <CodeGroup
      title="Request"
      tag="POST"
      label="/apps/annotation-reply/{action}"
      targetCode={`curl --location --request POST '${props.apiBaseUrl}/apps/annotation-reply/{action}' \\\n--header 'Authorization: Bearer {api_key}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{"score_threshold": 0.9, "embedding_provider_name": "zhipu", "embedding_model_name": "embedding_3"}'`}
    >
    ```bash {{ title: 'cURL' }}
    curl --location --request POST 'https://api.shai.ai/v1/apps/annotation-reply/{action}' \
    --header 'Authorization: Bearer {api_key}' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "score_threshold": 0.9,
        "embedding_provider_name": "zhipu",
        "embedding_model_name": "embedding_3"
    }'
    ```
    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "job_id": "b15c8f68-1cf4-4877-bf21-ed7cf2011802",
      "job_status": "waiting"
    }
    ```
    </CodeGroup>
    Этот интерфейс выполняется асинхронно, поэтому он вернет job_id. Вы можете получить окончательный результат выполнения, запросив интерфейс статуса задачи.
  </Col>
</Row>
---

<Heading
  url='/apps/annotation-reply/{action}/status/{job_id}'
  method='GET'
  title='Запросить статус задачи начальных настроек ответа с аннотацией'
  name='#initial_annotation_reply_settings_task_status'
/>
<Row>
  <Col>
    ### Запрос
    <Properties>
    <Property name='action' type='string' key='action'>
        Действие, может быть только 'enable' или 'disable', должно совпадать с действием в интерфейсе начальных настроек ответа с аннотацией
      </Property>
      <Property name='job_id' type='string' key='job_id'>
        ID задачи, 
      </Property>
    </Properties>
  </Col>
  <Col sticky>
    <CodeGroup
      title="Request"
      tag="GET"
      label="/apps/annotations"
      targetCode={`curl --location --request GET '${props.apiBaseUrl}/apps/annotation-reply/{action}/status/{job_id}' \\\n--header 'Authorization: Bearer {api_key}'`}
    >
    ```bash {{ title: 'cURL' }}
    curl --location --request GET '${props.apiBaseUrl}/apps/annotation-reply/{action}/status/{job_id}' \
    --header 'Authorization: Bearer {api_key}'
    ```
    </CodeGroup>

    <CodeGroup title="Ответ">
    ```json {{ title: 'Response' }}
    {
      "job_id": "b15c8f68-1cf4-4877-bf21-ed7cf2011802",
      "job_status": "waiting",
      "error_msg": ""
    }
    ```
    </CodeGroup>
  </Col>
</Row>
